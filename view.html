<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Supriya Digitals | Private Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <style>
        body { background: #111; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 30px; }
        .gallery-item img { width: 100%; border-radius: 5px; transition: 0.3s; }
        .gallery-item img:hover { transform: scale(1.02); }
        .filename { font-size: 0.8rem; color: #aaa; margin-top: 5px; }
        h1 { color: #FDAC53; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“¸ Shared Gallery</h1>
        <p class="text-muted">Supriya Digitals Studio</p>
        <div id="gallery" class="gallery-grid">
            <p class="text-white">Loading...</p>
        </div>
    </div>

    <script>
        const API_BASE = "https://pseudoascetical-pilose-bennett.ngrok-free.dev/supriya_studio/api/";
        
        const params = new URLSearchParams(window.location.search);
        const batchId = params.get('batch_id');
        const id = params.get('id');

        async function loadSharedMedia() {
            try {
                // Request 'shared' mode from API
                let url = `${API_BASE}fetch.php?mode=shared`;
                if(batchId) url += `&batch_id=${batchId}`;
                if(id) url += `&id=${id}`;

                const response = await fetch(url, { headers: { "ngrok-skip-browser-warning": "69420" } });
                const result = await response.json();

                if (result.success && result.data.length > 0) {
                    const html = result.data.map(item => `
                        <div class="gallery-item">
                            <img src="${item.file_path}" loading="lazy">
                            <div class="filename">${item.title_from_filename || item.title}</div>
                        </div>
                    `).join('');
                    document.getElementById('gallery').innerHTML = html;
                } else {
                    document.getElementById('gallery').innerHTML = "<p>Content not found or access denied.</p>";
                }
            } catch (e) {
                document.getElementById('gallery').innerHTML = "<p>Error loading gallery.</p>";
            }
        }
        loadSharedMedia();
    </script>
</body>
</html>